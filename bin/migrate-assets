#!/bin/bash
#
# Move production assets to './assets/vendor/'

TO='./assets/vendor'
FROM=(
    'normalize.css'
    'font-awesome'
    'html5shiv'
    'respond.js'
    'grottopress/wordpress-posts/assets'
    'grottopress/wordpress-posts/dist'
)

migrate()
{
    for dir in ${FROM[@]}; do
        dest="${TO}/${dir}"

        if [[ -d "./node_modules/${dir}" ]]; then
            src="./node_modules/${dir}"
        elif [[ -d "./vendor/${dir}" ]]; then
            src="./vendor/${dir}"
        else
            [[ -d "${dest}" ]] && rm -rf ${dest}

            continue
        fi

        [[ ! -d "${dest}" ]] && mkdir -p "${dest}"

        rsync -azPx --delete-after "${src}/" "${dest}/"
    done
}

removeUninstalledPackages()
{
    dirs=(${TO}/*)

    for dir in ${dirs[@]}; do
        dest="${dir##*\/}"

        [[ -d "./node_modules/${dest}" || -d "./vendor/${dest}" ]] && continue

        rm -rf ${dir}
    done
}

run()
{
    migrate
    removeUninstalledPackages
}

run

exit 0
